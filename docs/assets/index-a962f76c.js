(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const c=document.getElementById("game"),r=c.getContext("2d"),I=document.getElementById("hud"),A=document.getElementById("startBtn"),q=document.getElementById("pauseBtn"),G=document.getElementById("restartBtn"),y=document.getElementById("instructions"),S=document.getElementById("store"),T=[{emoji:"üè∞",name:"Basic Tower",damage:1,cost:5,projectile:"‚ú®",slow:1},{emoji:"‚ùÑÔ∏è",name:"Frost Tower",damage:1,cost:8,projectile:"‚ùÑÔ∏è",slow:.5}];let j=0;const x=[{emoji:"üëæ",health:3,speed:40},{emoji:"ü§ñ",health:6,speed:35},{emoji:"ü¶π",health:10,speed:30},{emoji:"üëπ",health:20,speed:25},{emoji:"üêâ",health:50,speed:15,boss:!0}];function N(){S.innerHTML=T.map((e,t)=>`<label><input type="radio" name="towerType" value="${t}" ${t===j?"checked":""}> ${e.emoji} ${e.name} - Cost ${e.cost}</label>`).join("<br>")+"<div>Click tower to upgrade (cost 5√ólevel)</div>",S.querySelectorAll('input[name="towerType"]').forEach(e=>e.addEventListener("change",t=>{j=Number(t.target.value)}))}N();let l=[];function C(){const n=Math.min(window.innerWidth,window.innerHeight)*.75;c.width=n,c.height=n;const e=c.width,t=c.height;l=[{x:0,y:t*.25},{x:e*.25,y:t*.25},{x:e*.25,y:t*.75},{x:e*.5,y:t*.75},{x:e*.5,y:t*.25},{x:e*.75,y:t*.25},{x:e*.75,y:t*.75},{x:e,y:t*.75}]}window.addEventListener("resize",C);C();let d=0,p=10,E=!1,w=!1,B,f=0;class z{constructor(e,t){this.type=e,this.x=l[0].x,this.y=l[0].y,this.speed=e.speed*t,this.health=Math.ceil(e.health*t),this.emoji=e.emoji,this.pathIndex=0,this.reward=Math.ceil(this.health/3),this.slowFactor=1,this.slowDuration=0}update(e){const t=l[this.pathIndex+1];if(!t)return!0;const o=t.x-this.x,s=t.y-this.y,i=Math.hypot(o,s),a=this.speed*this.slowFactor;return i<a*e?(this.x=t.x,this.y=t.y,this.pathIndex++):(this.x+=o/i*a*e,this.y+=s/i*a*e),this.slowDuration>0&&(this.slowDuration-=e,this.slowDuration<=0&&(this.slowFactor=1)),this.pathIndex>=l.length-1}applySlow(e,t){this.slowFactor=e,this.slowDuration=t}draw(){r.font="24px sans-serif",r.fillStyle="#fff",r.fillText(this.emoji,this.x-12,this.y+8)}}class H{constructor(e,t,o,s,i,a){this.x=e,this.y=t,this.target=o,this.emoji=s,this.damage=i,this.slow=a,this.speed=Math.max(250,this.target.speed*1.5)}update(e){const t=this.target.x-this.x,o=this.target.y-this.y,s=Math.hypot(t,o);return s<5?(this.target.health-=this.damage,this.slow<1&&this.target.applySlow(this.slow,2),!0):(this.x+=t/s*this.speed*e,this.y+=o/s*this.speed*e,!1)}draw(){r.font="20px sans-serif",r.fillStyle="#fff",r.fillText(this.emoji,this.x,this.y)}}class R{constructor(e,t,o){this.x=e,this.y=t,this.data=o,this.range=80,this.cooldown=0,this.level=1}upgrade(){return this.level<3?(this.level+=1,!0):!1}update(e,t){if(this.cooldown-=e,this.cooldown<=0){const o=t.find(s=>Math.hypot(s.x-this.x,s.y-this.y)<this.range);if(o){const s=this.level*this.data.damage;u.push(new H(this.x,this.y,o,this.data.projectile,s,this.data.slow)),this.cooldown=.5}}}draw(){r.font="24px sans-serif",r.fillStyle="#fff",r.fillText(this.data.emoji,this.x-12,this.y)}}const h=[],g=[],u=[],$=20;let v=0;function W(n,e,t,o,s,i){const a=s-t,m=i-o;if(a===0&&m===0)return Math.hypot(n-t,e-o);const P=((n-t)*a+(e-o)*m)/(a*a+m*m),L=Math.max(0,Math.min(1,P)),D=t+L*a,k=o+L*m;return Math.hypot(n-D,e-k)}function Y(n,e){for(let t=0;t<l.length-1;t++)if(W(n,e,l[t].x,l[t].y,l[t+1].x,l[t+1].y)<=$/2)return!0;return!1}function F(){E||(E=!0,d+=T[0].cost),w||(w=!0,y.style.display="none",I.textContent=`üí∞${d} ‚ù§Ô∏è${p}`,M=performance.now(),B=requestAnimationFrame(O))}function b(){w&&(w=!1,cancelAnimationFrame(B))}function K(){b(),h.length=0,g.length=0,u.length=0,d=0,p=10,f=0,I.textContent=`üí∞${d} ‚ù§Ô∏è${p}`,E=!1,y.textContent="Click anywhere on the board to build towers. You start with enough gold for one tower.",y.style.display="block"}A.addEventListener("click",F);q.addEventListener("click",b);G.addEventListener("click",K);c.addEventListener("click",n=>{if(!w){F();return}const{offsetX:e,offsetY:t}=n,o=g.find(s=>Math.hypot(s.x-e,s.y-t)<20);if(o){const s=o.level*5;d>=s&&o.upgrade()&&(d-=s)}else{const s=T[j],i=s.cost;d>=i&&!Y(e,t)&&(g.push(new R(e,t,s)),d-=i)}});let M=0;function O(n){const e=(n-M)/1e3;if(M=n,v-=e,v<=0){f++;const t=1+f*.03;let o;f%50===0?o=x[x.length-1]:o=x[Math.min(x.length-2,Math.floor(f/20))],h.push(new z(o,t)),v=Math.max(.3,2-f*.03)}r.clearRect(0,0,c.width,c.height),r.fillStyle="#333",r.fillRect(0,0,c.width,c.height),r.strokeStyle="#555",r.lineWidth=$,r.beginPath(),r.moveTo(l[0].x,l[0].y);for(const t of l.slice(1))r.lineTo(t.x,t.y);r.stroke();for(const t of h)t.update(e)&&(p-=1);for(const t of g)t.update(e,h);for(const t of u)t.update(e)&&u.splice(u.indexOf(t),1);h.filter(t=>t.health<=0).forEach(t=>{d+=t.reward});for(let t=h.length-1;t>=0;t--)(h[t].health<=0||h[t].pathIndex>=l.length-1)&&h.splice(t,1);for(const t of h)t.draw();for(const t of g)t.draw();for(const t of u)t.draw();I.textContent=`üí∞${d} ‚ù§Ô∏è${p}`,p<=0&&(b(),y.textContent="Game Over",y.style.display="block"),B=requestAnimationFrame(O)}

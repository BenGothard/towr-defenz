(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const h=document.getElementById("game"),o=h.getContext("2d"),B=document.getElementById("hud"),G=document.getElementById("startBtn"),q=document.getElementById("pauseBtn"),z=document.getElementById("restartBtn"),m=document.getElementById("instructions"),H=document.getElementById("store"),x=[{emoji:"üè∞",name:"Basic Tower",damage:1,cost:5}],L=["‚ú®","üí•","üî•"],T=[{emoji:"üëæ",health:3,speed:40},{emoji:"ü§ñ",health:6,speed:35},{emoji:"ü¶π",health:10,speed:30}];function N(){H.innerHTML=`${x[0].emoji} ${x[0].name} - Cost ${x[0].cost}<br>Click tower to upgrade (cost 5√ólevel)`}N();let c=[];function b(){const r=Math.min(window.innerWidth,window.innerHeight)*.75;h.width=r,h.height=r;const e=h.width,t=h.height;c=[{x:0,y:t*.25},{x:e*.25,y:t*.25},{x:e*.25,y:t*.75},{x:e*.5,y:t*.75},{x:e*.5,y:t*.25},{x:e*.75,y:t*.25},{x:e*.75,y:t*.75},{x:e,y:t*.75}]}window.addEventListener("resize",b);b();let d=0,u=10,j=!1,g=!1,I,w=0;class D{constructor(e,t){this.type=e,this.x=c[0].x,this.y=c[0].y,this.speed=e.speed*t,this.health=Math.ceil(e.health*t),this.emoji=e.emoji,this.pathIndex=0}update(e){const t=c[this.pathIndex+1];if(!t)return!0;const n=t.x-this.x,s=t.y-this.y,i=Math.hypot(n,s);return i<this.speed*e?(this.x=t.x,this.y=t.y,this.pathIndex++):(this.x+=n/i*this.speed*e,this.y+=s/i*this.speed*e),this.pathIndex>=c.length-1}draw(){o.font="24px sans-serif",o.fillStyle="#fff",o.fillText(this.emoji,this.x-12,this.y+8)}}class R{constructor(e,t,n,s,i){this.x=e,this.y=t,this.target=n,this.emoji=s,this.damage=i,this.speed=200}update(e){const t=this.target.x-this.x,n=this.target.y-this.y,s=Math.hypot(t,n);return s<5?(this.target.health-=this.damage,!0):(this.x+=t/s*this.speed*e,this.y+=n/s*this.speed*e,!1)}draw(){o.font="20px sans-serif",o.fillStyle="#fff",o.fillText(this.emoji,this.x,this.y)}}class O{constructor(e,t){this.x=e,this.y=t,this.range=80,this.cooldown=0,this.level=1}upgrade(){return this.level<L.length?(this.level+=1,!0):!1}update(e,t){if(this.cooldown-=e,this.cooldown<=0){const n=t.find(s=>Math.hypot(s.x-this.x,s.y-this.y)<this.range);n&&(f.push(new R(this.x,this.y,n,L[this.level-1],this.level)),this.cooldown=.5)}}draw(){o.font="24px sans-serif",o.fillStyle="#fff",o.fillText("üè∞",this.x-12,this.y)}}const l=[],y=[],f=[],$=20;let v=0;function W(r,e,t,n,s,i){const a=s-t,p=i-n;if(a===0&&p===0)return Math.hypot(r-t,e-n);const k=((r-t)*a+(e-n)*p)/(a*a+p*p),C=Math.max(0,Math.min(1,k)),A=t+C*a,F=n+C*p;return Math.hypot(r-A,e-F)}function K(r,e){for(let t=0;t<c.length-1;t++)if(W(r,e,c[t].x,c[t].y,c[t+1].x,c[t+1].y)<=$/2)return!0;return!1}function P(){j||(j=!0,y.push(new O(h.width/2,h.height/2-50))),g||(g=!0,m.style.display="none",B.textContent=`üí∞${d} ‚ù§Ô∏è${u}`,E=performance.now(),I=requestAnimationFrame(S))}function M(){g&&(g=!1,cancelAnimationFrame(I))}function X(){M(),l.length=0,y.length=0,f.length=0,d=0,u=10,w=0,B.textContent=`üí∞${d} ‚ù§Ô∏è${u}`,j=!1,m.textContent="Click anywhere on the board to build towers and defend the path.",m.style.display="block"}G.addEventListener("click",P);q.addEventListener("click",M);z.addEventListener("click",X);h.addEventListener("click",r=>{if(!g){P();return}const{offsetX:e,offsetY:t}=r,n=y.find(s=>Math.hypot(s.x-e,s.y-t)<20);if(n){const s=n.level*5;d>=s&&n.upgrade()&&(d-=s)}else{const s=x[0].cost;d>=s&&!K(e,t)&&(y.push(new O(e,t)),d-=s)}});let E=0;function S(r){const e=(r-E)/1e3;if(E=r,v-=e,v<=0){const t=1+w*.05,n=T[Math.min(T.length-1,Math.floor(w/10))];l.push(new D(n,t)),w++,v=2}o.clearRect(0,0,h.width,h.height),o.fillStyle="#333",o.fillRect(0,0,h.width,h.height),o.strokeStyle="#555",o.lineWidth=$,o.beginPath(),o.moveTo(c[0].x,c[0].y);for(const t of c.slice(1))o.lineTo(t.x,t.y);o.stroke();for(const t of l)t.update(e)&&(u-=1);for(const t of y)t.update(e,l);for(const t of f)t.update(e)&&f.splice(f.indexOf(t),1);l.filter(t=>t.health<=0).forEach(()=>{d+=1});for(let t=l.length-1;t>=0;t--)(l[t].health<=0||l[t].pathIndex>=c.length-1)&&l.splice(t,1);for(const t of l)t.draw();for(const t of y)t.draw();for(const t of f)t.draw();B.textContent=`üí∞${d} ‚ù§Ô∏è${u}`,u<=0&&(M(),m.textContent="Game Over",m.style.display="block"),I=requestAnimationFrame(S)}

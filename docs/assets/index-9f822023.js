(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const l=document.getElementById("game"),i=l.getContext("2d"),M=document.getElementById("hud"),F=document.getElementById("startBtn"),G=document.getElementById("pauseBtn"),q=document.getElementById("restartBtn"),p=document.getElementById("instructions"),z=document.getElementById("store"),m=[{emoji:"üè∞",name:"Basic Tower",damage:1,cost:5}],L=["‚ú®","üí•","üî•"],T=[{emoji:"üëæ",health:3,speed:40},{emoji:"ü§ñ",health:6,speed:35},{emoji:"ü¶π",health:10,speed:30}];function H(){z.innerHTML=`${m[0].emoji} ${m[0].name} - Cost ${m[0].cost}<br>Click tower to upgrade (cost 5√ólevel)`}H();let c=[];function b(){const r=Math.min(window.innerWidth,window.innerHeight)*.75;l.width=r,l.height=r;const e=l.width,t=l.height;c=[{x:0,y:t*.25},{x:e*.25,y:t*.25},{x:e*.25,y:t*.75},{x:e*.5,y:t*.75},{x:e*.5,y:t*.25},{x:e*.75,y:t*.25},{x:e*.75,y:t*.75},{x:e,y:t*.75}]}window.addEventListener("resize",b);b();let a=0,u=10,j=!1,g=!1,B,w=0;class N{constructor(e,t){this.type=e,this.x=c[0].x,this.y=c[0].y,this.speed=e.speed*t,this.health=Math.ceil(e.health*t),this.emoji=e.emoji,this.pathIndex=0,this.reward=Math.ceil(this.health/3)}update(e){const t=c[this.pathIndex+1];if(!t)return!0;const n=t.x-this.x,s=t.y-this.y,o=Math.hypot(n,s);return o<this.speed*e?(this.x=t.x,this.y=t.y,this.pathIndex++):(this.x+=n/o*this.speed*e,this.y+=s/o*this.speed*e),this.pathIndex>=c.length-1}draw(){i.font="24px sans-serif",i.fillStyle="#fff",i.fillText(this.emoji,this.x-12,this.y+8)}}class D{constructor(e,t,n,s,o){this.x=e,this.y=t,this.target=n,this.emoji=s,this.damage=o,this.speed=200}update(e){const t=this.target.x-this.x,n=this.target.y-this.y,s=Math.hypot(t,n);return s<5?(this.target.health-=this.damage,!0):(this.x+=t/s*this.speed*e,this.y+=n/s*this.speed*e,!1)}draw(){i.font="20px sans-serif",i.fillStyle="#fff",i.fillText(this.emoji,this.x,this.y)}}class R{constructor(e,t){this.x=e,this.y=t,this.range=80,this.cooldown=0,this.level=1}upgrade(){return this.level<L.length?(this.level+=1,!0):!1}update(e,t){if(this.cooldown-=e,this.cooldown<=0){const n=t.find(s=>Math.hypot(s.x-this.x,s.y-this.y)<this.range);n&&(f.push(new D(this.x,this.y,n,L[this.level-1],this.level)),this.cooldown=.5)}}draw(){i.font="24px sans-serif",i.fillStyle="#fff",i.fillText("üè∞",this.x-12,this.y)}}const h=[],x=[],f=[],O=20;let v=0;function W(r,e,t,n,s,o){const d=s-t,y=o-n;if(d===0&&y===0)return Math.hypot(r-t,e-n);const S=((r-t)*d+(e-n)*y)/(d*d+y*y),C=Math.max(0,Math.min(1,S)),k=t+C*d,A=n+C*y;return Math.hypot(r-k,e-A)}function Y(r,e){for(let t=0;t<c.length-1;t++)if(W(r,e,c[t].x,c[t].y,c[t+1].x,c[t+1].y)<=O/2)return!0;return!1}function $(){j||(j=!0,a+=m[0].cost),g||(g=!0,p.style.display="none",M.textContent=`üí∞${a} ‚ù§Ô∏è${u}`,E=performance.now(),B=requestAnimationFrame(P))}function I(){g&&(g=!1,cancelAnimationFrame(B))}function K(){I(),h.length=0,x.length=0,f.length=0,a=0,u=10,w=0,M.textContent=`üí∞${a} ‚ù§Ô∏è${u}`,j=!1,p.textContent="Click anywhere on the board to build towers. You start with enough gold for one tower.",p.style.display="block"}F.addEventListener("click",$);G.addEventListener("click",I);q.addEventListener("click",K);l.addEventListener("click",r=>{if(!g){$();return}const{offsetX:e,offsetY:t}=r,n=x.find(s=>Math.hypot(s.x-e,s.y-t)<20);if(n){const s=n.level*5;a>=s&&n.upgrade()&&(a-=s)}else{const s=m[0].cost;a>=s&&!Y(e,t)&&(x.push(new R(e,t)),a-=s)}});let E=0;function P(r){const e=(r-E)/1e3;if(E=r,v-=e,v<=0){const t=1+w*.03,n=T[Math.min(T.length-1,Math.floor(w/15))];h.push(new N(n,t)),w++,v=2}i.clearRect(0,0,l.width,l.height),i.fillStyle="#333",i.fillRect(0,0,l.width,l.height),i.strokeStyle="#555",i.lineWidth=O,i.beginPath(),i.moveTo(c[0].x,c[0].y);for(const t of c.slice(1))i.lineTo(t.x,t.y);i.stroke();for(const t of h)t.update(e)&&(u-=1);for(const t of x)t.update(e,h);for(const t of f)t.update(e)&&f.splice(f.indexOf(t),1);h.filter(t=>t.health<=0).forEach(t=>{a+=t.reward});for(let t=h.length-1;t>=0;t--)(h[t].health<=0||h[t].pathIndex>=c.length-1)&&h.splice(t,1);for(const t of h)t.draw();for(const t of x)t.draw();for(const t of f)t.draw();M.textContent=`üí∞${a} ‚ù§Ô∏è${u}`,u<=0&&(I(),p.textContent="Game Over",p.style.display="block"),B=requestAnimationFrame(P)}
